<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>音乐播放器</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="music play" />
    <meta name="description" content="基于iframe，history api实现的音乐播放器，切换页面不间断播放" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
    <style type="text/css">
        #wrapper {
            padding: 1px;
            position: relative;
        }
    </style>
</head>

<body>
    <div id="wrapper" data-url="http://app.local">
        <div id="block1" style="width:100%;height:100%;">
            <!-- http://pagalworld.com/files/9667/Nanak%20Shah%20Fakir%20(2015)%20Mp3%20Songs.html  -->
            <iframe src="test1.html" id="iframe1" name="iframe1" frameborder="0" scrolling="no" style="width:100%;"></iframe>
        </div>

        <div id="block2" style="position:fixed;left:0;bottom:0;z-index:999;width:100%;max-height:60px;">
            <iframe src="test2.html" id="iframe2" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" style="width:100%;max-height:60px;"></iframe>
        </div>
    </div>

    <script type="text/javascript">
        // 如果在同个顶级域名下，不同子域名之间互通信息，需要设置document.domain = 'xx.com';

        // 高度自适应
        /*
        var iframe1 = document.getElementById('iframe1');
        window.onload = function() {
            // 同域下才可以获取iframe1.contentDocument(document) === iframe1.contentWindow.document
            var clientHeight = iframe1.contentDocument.body.clientHeight, // 获取iframe里的document.body高度
                scrollHeight = iframe1.contentDocument.body.scrollHeight;
                actualHeight = Math.max(clientHeight, scrollHeight);
            console.log('index');
            console.log(actualHeight);
            // console.log(window.frames['iframe1']);
            iframe1.height = actualHeight + 70;
        };


        // 内容宽度变化的iframe高度自适应，iframe需要初始化高度：onload="this.height=200"
        // var timer = setInterval(function() {
        //     try {
        //         var bHeight = iframe1.contentWindow.document.body.scrollHeight;
        //         var dHeight = iframe1.contentWindow.document.documentElement.scrollHeight;
        //         var actualHeight = Math.max(bHeight, dHeight);
        //         console.log(actualHeight);
        //         iframe1.height = actualHeight;
        //     } catch (ex) {
        //         console.log(ex);
        //     }
        // }, 200);

        function test() {
            console.log('index');
        }
        */

        /*
        // history api 管理
        var iframe1 = document.getElementById('iframe1');
        var href = iframe1.getAttribute('src');
        var newTitle = iframe1.contentWindow.document.title;
        console.log(href, newTitle);
        window.history.replaceState(null, newTitle, href); // 当前页面url替换iframe的url
        if (window.history.pushState) {
            var state = {
                url: href,
                title: newTitle
            };
            window.history.pushState(state, newTitle, href);
        }

        // 监听浏览器回退事件
        window.addEventListener('popstate', function(event){
            var state = event.state;
            console.log(history.state);
            if (state) {
                console.log("location: " + document.location + ", state: " + JSON.stringify(state));
                document.title = state.title;
            } else {
                // 回到最开始的页面链接
            }
        }, false);
        */
    </script>
</body>
</html>

